<!DOCTYPE html>  <html> <head>   <title>command.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="md.html">                 md.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               command.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><a href="http://neocotic.com/html.md">html.md</a> <br />
(c) 2013 Alasdair Mercer <br />
Freely distributable under the MIT license. <br />
Based on <a href="http://homepage.mac.com/tjim/">Make.text</a> 1.5 <br />
(c) 2007 Trevor Jim <br />
For all details and documentation: <br />
<a href="http://neocotic.com/html.md">http://neocotic.com/html.md</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Module dependencies</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">fs      = </span><span class="nx">require</span> <span class="s">&#39;fs-extra&#39;</span>
<span class="nv">md      = </span><span class="nx">require</span> <span class="s">&#39;./md&#39;</span>
<span class="nv">path    = </span><span class="nx">require</span> <span class="s">&#39;path&#39;</span>
<span class="nv">program = </span><span class="nx">require</span> <span class="s">&#39;commander&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Private constants</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Error code used by node when a file/directory could not be found.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">NOT_FOUND  = </span><span class="s">&#39;ENOENT&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Regular expression used to identify HTML files using common extensions.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">R_HTML_EXT = </span><span class="sr">/\.s?html?$/i</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Private variables</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>File extension to be applied to any Markdown files that are created.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">extension = </span><span class="s">&#39;.md&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>List of HTML sources passed in at runtime. <br />
These can either be paths or a single HTML input (if <code>eval</code> option was enabled).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">sources   = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Private functions</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Exit the process <em>gracefully</em>, optionally displaying <code>message</code> before doing so.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exit = </span><span class="nf">(code, message) -&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">code</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
    <span class="nv">message = </span><span class="nx">code</span>
    <span class="nv">code    = </span><span class="kc">null</span>

  <span class="nx">code</span> <span class="o">?=</span> <span class="mi">0</span>

  <span class="nx">console</span><span class="p">[</span><span class="k">if</span> <span class="nx">code</span> <span class="k">then</span> <span class="s">&#39;error&#39;</span> <span class="k">else</span> <span class="s">&#39;log&#39;</span><span class="p">]</span> <span class="nx">message</span> <span class="k">if</span> <span class="nx">message</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span> <span class="nx">code</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Resolve the output path for <code>source</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">outputPath = </span><span class="nf">(source, root) -&gt;</span>
  <span class="nv">fileName = </span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span> <span class="o">+</span> <span class="nx">extension</span>
  <span class="nv">srcDir   = </span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span> <span class="nx">source</span>
  <span class="nv">dir      = </span><span class="k">if</span> <span class="nx">program</span><span class="p">.</span><span class="nx">output</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">program</span><span class="p">.</span><span class="nx">output</span><span class="p">,</span> <span class="k">if</span> <span class="nx">root</span> <span class="o">is</span> <span class="s">&#39;.&#39;</span> <span class="k">then</span> <span class="nx">srcDir</span> <span class="k">else</span> <span class="nx">srcDir</span><span class="p">[</span><span class="nx">root</span><span class="p">.</span><span class="nx">length</span><span class="p">..]</span>
  <span class="k">else</span>
    <span class="nx">srcDir</span>

  <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">fileName</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Attempt to either parse the contents of the <code>source</code> path or, if it's a directory, the contents
of its children HTML files.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">parsePath = </span><span class="nf">(source, topLevel, root) -&gt;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span> <span class="nx">source</span><span class="p">,</span> <span class="nf">(err, stats) -&gt;</span>
    <span class="k">if</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>We only care about <code>ENOENT</code> errors so everything else is thrown.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">isnt</span> <span class="nx">NOT_FOUND</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Either exit stating the file could not be found or attempt to make improve the file name's
searchability and trying again.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">topLevel</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">R_HTML_EXT</span><span class="p">.</span><span class="nx">test</span> <span class="nx">source</span>
        <span class="nv">source = </span><span class="nx">sources</span><span class="p">[</span><span class="nx">sources</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">source</span><span class="p">)]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">source</span><span class="si">}</span><span class="s">.html&quot;</span>
        <span class="nx">parsePath</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">topLevel</span><span class="p">,</span> <span class="nx">root</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">topLevel</span>
        <span class="nx">exit</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;File not found: </span><span class="si">#{</span><span class="nx">source</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>source</code> is a directory so we're going to expand it to include all of its children files
and check each of them.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span> <span class="nx">source</span><span class="p">,</span> <span class="nf">(err, files) -&gt;</span>
        <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Ensure <code>files</code> are relative to their parent directory.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">files = </span><span class="nx">files</span><span class="p">.</span><span class="nx">map</span> <span class="nf">(file) -&gt;</span>
          <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">file</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Replace the directory in <code>sources</code> with all of its children files.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">index = </span><span class="nx">sources</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">source</span>
        <span class="nx">sources</span><span class="p">[</span><span class="nx">index</span><span class="p">..</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">files</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Now finally try to parse all of the directory <code>files</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">parsePath</span> <span class="nx">file</span><span class="p">,</span> <span class="kc">no</span><span class="p">,</span> <span class="nx">root</span> <span class="k">for</span> <span class="nx">file</span> <span class="k">in</span> <span class="nx">files</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">topLevel</span> <span class="o">or</span> <span class="nx">R_HTML_EXT</span><span class="p">.</span><span class="nx">test</span> <span class="nx">source</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Possible source file found so read its contents.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span> <span class="nx">source</span><span class="p">,</span> <span class="nf">(err, html) -&gt;</span>
        <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Treat the files contents as HTML and try to parse it using <code>md</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">parseHtml</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">html</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nx">root</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Doesn't appear to have a recognizable HTML file extension so just ignore the file and
remove it from the list of <code>sources</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">sources</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">sources</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">source</span><span class="p">),</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Parse the HTML <code>input</code> and write it out accordingly.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">parseHtml = </span><span class="nf">(file, input, root) -&gt;</span>
  <span class="k">try</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Extract only relevant options from <code>program</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">{</span><span class="nx">absolute</span><span class="p">,</span> <span class="nx">base</span><span class="p">,</span>  <span class="nx">debug</span><span class="p">,</span> <span class="nx">inline</span><span class="p">}</span> <span class="o">=</span> <span class="nx">program</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Let <code>md</code> work its magic on the HTML <code>input</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">output                           = </span><span class="nx">md</span> <span class="nx">input</span><span class="p">,</span> <span class="p">{</span><span class="nx">absolute</span><span class="p">,</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">debug</span><span class="p">,</span> <span class="nx">inline</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Either write the output to <code>stdout</code> or to a corresponding Markdown file depending on whether
the <code>print</code> option was enabled.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">program</span><span class="p">.</span><span class="nx">print</span> <span class="k">then</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">output</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">file</span>     <span class="k">then</span> <span class="nx">writeMarkdown</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">output</span><span class="p">,</span> <span class="nx">root</span>
  <span class="k">catch</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>An error occured while parsing <code>input</code>, so stop processing all sources and exit, while also
letting the user know why.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">exit</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Parse the options that could have been provided at runtime.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">parseOptions = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Parse the specified options/switches/flags/whatever.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">program</span>
    <span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">version</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">usage</span><span class="p">(</span><span class="s">&#39;[options] [ -e html | &lt;file ...&gt; ]&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-a, --absolute&#39;</span><span class="p">,</span>     <span class="s">&#39;always use absolute URLs for links and images&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-b, --base &lt;url&gt;&#39;</span><span class="p">,</span>   <span class="s">&#39;set base URL to resolve relative URLs from&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-d, --debug&#39;</span><span class="p">,</span>        <span class="s">&#39;print additional debug information&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-e, --eval&#39;</span><span class="p">,</span>         <span class="s">&#39;pass a string from the command line as input&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-i, --inline&#39;</span><span class="p">,</span>       <span class="s">&#39;generate inline style links&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-l, --long-ext&#39;</span><span class="p">,</span>     <span class="s">&#39;use long extension for Markdown files&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-o, --output &lt;dir&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;set the output directory for converted Markdown&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s">&#39;-p, --print&#39;</span><span class="p">,</span>        <span class="s">&#39;print out the converted Markdown&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">parse</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Ensure that the longer Markdown file extension is used if/when the associated option is
enabled.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">extension = </span><span class="s">&#39;.markdown&#39;</span> <span class="k">if</span> <span class="nx">program</span><span class="p">.</span><span class="nx">longExt</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>All left-over arguments are considered potential HTML source files/input and will be handled as
such.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sources   = </span><span class="nx">program</span><span class="p">.</span><span class="nx">args</span><span class="p">[..]</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>No additional arguments were specified? Then simply print out the usage as the user might not
know how to use this command.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">program</span><span class="p">.</span><span class="nx">help</span><span class="p">()</span> <span class="nx">unless</span> <span class="nx">sources</span><span class="p">.</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Write the <code>markdown</code> converted from <code>source</code> to its relative output file.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">writeMarkdown = </span><span class="nf">(source, markdown, root) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Derive the best output file path based on the name of the <code>source</code> file.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mdPath = </span><span class="nx">outputPath</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">root</span>
  <span class="nv">mdDir  = </span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span> <span class="nx">mdPath</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Write <code>markdown</code> to its corresponding output file.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">write = </span><span class="nf">(err) -&gt;</span>
    <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Ensure something is always written in the file.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">markdown = </span><span class="s">&#39; &#39;</span> <span class="k">if</span> <span class="nx">markdown</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span> <span class="nx">mdPath</span><span class="p">,</span> <span class="nx">markdown</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
      <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>If the target files parent directory doesn't already exists, create it before writing to the
file itself.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span> <span class="nx">mdDir</span><span class="p">,</span> <span class="nf">(exists) -&gt;</span>
    <span class="k">if</span> <span class="nx">exists</span> <span class="k">then</span> <span class="nx">do</span> <span class="nx">write</span> <span class="k">else</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdirs</span> <span class="nx">mdDir</span><span class="p">,</span> <span class="nx">write</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <h2>Public API</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Handle the runtime arguments accordingly.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.run = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Try to ensure <em>graceful</em> exits whenever possible.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">unless</span> <span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">is</span> <span class="s">&#39;win32&#39;</span>
    <span class="nx">process</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;SIGTERM&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">do</span> <span class="nx">exit</span>

  <span class="k">try</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Parse the arguments passed in at runtime as options/switches.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">do</span> <span class="nx">parseOptions</span>

    <span class="k">if</span> <span class="nx">program</span><span class="p">.</span><span class="nb">eval</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Parse the arguments as direct HTML input and print the output to <code>stdout</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">parseHtml</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">sources</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Read each of the relevant targeted source files and parse them into HTML, sending each
output either to <code>stdout</code> or a corresponding Markdown file, depending on what options are
enabled.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">parsePath</span> <span class="nx">source</span><span class="p">,</span> <span class="kc">yes</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">normalize</span> <span class="nx">source</span> <span class="k">for</span> <span class="nx">source</span> <span class="k">in</span> <span class="nx">sources</span>
  <span class="k">catch</span> <span class="nx">err</span>
    <span class="nx">exit</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">err</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 