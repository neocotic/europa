/*! Europa v4.0.0 | (C) 2018 Alasdair Mercer, !ninja | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Europa=t()}(this,function(){"use strict";class e{static forOwn(t,r,n){if(t)for(const a in t)e.hasOwn(t,a)&&r.call(n,t[a],a,t)}static hasOwn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}static leftPad(e,t,r){if(null==e&&(e=""),null==t&&(t=0),null==r&&(r=" "),!r)return e;for(let n=0;n<t;n++)e=r+e;return e}}var t=e;const r={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},n={};t.forOwn(r,(e,t)=>{n[t]=new RegExp(t,"g")});var a=class{constructor(e,t){this.europa=e,this.options=t,this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0,this.buffer="",this.context={},this.inCodeBlock=!1,this.inOrderedList=!1,this.inPreformattedBlock=!1,this.last=null,this.left="\n",this.listDepth=0,this.listIndex=1,this._document=e.document,this._element=null,this._tagName=null,this._window=e.window}append(e){return null!=this.last&&(this.buffer+=this.last),this.last=e,this}appendParagraph(){return this.atParagraph?this:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWhiteSpace=!0,this.atParagraph=!0,this)}output(e,a){return e?(e=e.replace(/\r\n/g,"\n"),a&&(e=e.replace(/\n([ \t]*\n)+/g,"\n").replace(/\n[ \t]+/g,"\n").replace(/[ \t]+/g," "),t.forOwn(r,(t,r)=>{e=e.replace(n[r],t)})),this.inPreformattedBlock||(e=this.atNoWhiteSpace?e.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(e)?e.replace(/^[ \t\n]+/,"\n"):e.replace(/^[ \t]+/," ")),e?(this.atLeft=/\n$/.test(e),this.atNoWhiteSpace=/[ \t\n]$/.test(e),this.atParagraph=/\n{2}$/.test(e),this.append(e.replace(/\n/g,this.left))):this):this}replaceLeft(e){return this.atLeft?this.last&&(this.last=this.last.replace(/[ ]{2,4}$/,e)):(this.append(this.left.replace(/[ ]{2,4}$/,e)),this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0),this}get document(){return this._document}get element(){return this._element}set element(e){this._element=e,this._tagName=e&&e.tagName?e.tagName.toLowerCase():null}get tagName(){return this._tagName}get window(){return this._window}set window(e){this._window=e,this._document=e?e.document:null}};var s=class{static isVisible(e,t){const r=t.getComputedStyle(e);return"none"!==r.getPropertyValue("display")&&"hidden"!==r.getPropertyValue("visibility")}};var i=class{constructor(e,t){this.name=e,this._defaultValue=t}get defaultValue(){const e=this._defaultValue;return"function"==typeof e?e.call(this):e}};var o=class{constructor(e){this.options=e}exists(e){return this.options.some(t=>t.name===e)}parse(e){e||(e={});const t={};return this.options.forEach(r=>{const{name:n}=r,a=null!=e[n]?e[n]:r.defaultValue;t[n]=a}),t}};var l=class{after(e,t){}afterAll(e){}before(e,t){}beforeAll(e){}convert(e,t){return!0}getTagNames(){return[]}};const u={},c=new class{constructor(){this._services={}}getService(e){const t=this._services[e];if(!t)throw new Error(`Service is not being managed with name: ${e}`);return t}setService(e,t){if(this._services[e])throw new Error(`Service is already managed with name: ${e}`);t&&(this._services[e]=t)}};var p=class{static get Plugin(){return l}static register(e){e.getTagNames().forEach(t=>{u[t]=e})}static use(e){c.setService(e.getName(),e)}constructor(e){this._options=new o([new i("absolute",!1),new i("baseUri",()=>c.getService("window").getDefaultBaseUri()),new i("inline",!1)]).parse(e),this._window=null}convert(e){if(!e)return"";const{document:r}=this;let n;"string"==typeof e?(n=r.createElement("div")).innerHTML=e:n=e;const s=new a(this,this._options);let i;r.contains(n)||((i=r.createElement("div")).style.display="none",i.appendChild(n),r.body.appendChild(i));try{t.forOwn(u,e=>e.beforeAll(s)),this.convertElement(n,s),t.forOwn(u,e=>e.afterAll(s))}finally{i&&(r.body.removeChild(i),i.removeChild(n))}return s.append("").buffer.trim()}convertElement(e,t){if(!e)return;const{window:r}=this;if(e.nodeType===r.Node.ELEMENT_NODE){if(!s.isVisible(e,r))return;t.element=e;const n={},a=u[t.tagName];let i=!0;if(a&&(a.before(t,n),i=a.convert(t,n)),i)for(let r=0;r<e.childNodes.length;r++)this.convertElement(e.childNodes[r],t);a&&a.after(t,n)}else if(e.nodeType===r.Node.TEXT_NODE){const r=e.nodeValue||"";t.inPreformattedBlock?t.output(r):t.inCodeBlock?t.output(r.replace(/`/g,"\\`")):t.output(r,!0)}}release(){return this._window&&(c.getService("window").closeWindow(this._window),this._window=null),this}get document(){return this.window.document}get window(){return this._window||(this._window=c.getService("window").getWindow(this._options.baseUri)),this._window}};p.register(new class extends l{after(e,t){null!=t.value&&e.output(`]${t.value}`)}afterAll(e){const{anchors:t}=e.context;if(t.length){e.append("\n\n");for(let r=0;r<t.length;r++)e.append(`[anchor${r}]: ${t[r]}\n`)}}beforeAll(e){e.context.anchorMap={},e.context.anchors=[]}convert(e,t){const{element:r,options:n}=e,a=n.absolute?r.href:r.getAttribute("href");if(!a)return!0;const{anchorMap:s,anchors:i}=e.context,o=r.getAttribute("title"),l=o?`${a} "${o}"`:a;let u;return n.inline?t.value=`(${l})`:(null==(u=s[l])&&(u=i.push(l)-1,s[l]=u),t.value=`[anchor${u}]`),e.output("["),e.atNoWhiteSpace=!0,!0}getTagNames(){return["a"]}});p.register(new class extends l{after(e,t){e.atLeft=!1,e.atParagraph=!1,e.left=t.previousLeft,e.appendParagraph()}before(e,t){t.previousLeft=e.left}convert(e,t){return e.left+="> ",e.atParagraph?e.append("> "):e.appendParagraph(),!0}getTagNames(){return["blockquote","dd"]}});p.register(new class extends l{convert(e,t){return e.append(`  ${e.left}`),e.atLeft=!0,e.atNoWhiteSpace=!0,!1}getTagNames(){return["br"]}});p.register(new class extends l{after(e,t){t.skipped||(e.inCodeBlock=t.previousInCodeBlock,e.output("`"))}before(e,t){t.previousInCodeBlock=e.inCodeBlock}convert(e,t){return e.inPreformattedBlock?t.skipped=!0:(e.output("`"),e.inCodeBlock=!0),!0}getTagNames(){return["code","kbd","samp"]}});p.register(new class extends l{after(e,t){e.output("**")}convert(e,t){return e.appendParagraph(),e.output("**"),e.atNoWhiteSpace=!0,!0}getTagNames(){return["dt"]}});p.register(new class extends l{convert(e,t){const{element:r}=e;if(e.appendParagraph(),r.hasAttribute("open"))return!0;const n=r.querySelector("summary");return e.europa.convertElement(n,e),!1}getTagNames(){return["details"]}});p.register(new class extends l{after(e,t){e.output("_")}convert(e,t){return e.output("_"),e.atNoWhiteSpace=!0,!0}getTagNames(){return["cite","dfn","em","i","u","var"]}});p.register(new class extends l{convert(e,t){return!1}getTagNames(){return["applet","area","audio","button","canvas","datalist","embed","head","input","map","menu","meter","noframes","noscript","object","optgroup","option","param","progress","rp","rt","ruby","script","select","style","textarea","title","video"]}});p.register(new class extends l{after(e,t){e.window=t.previousWindow}before(e,t){t.previousWindow=e.window}convert(e,t){const r=e.element.contentWindow;return r&&(e.window=r,e.europa.convertElement(r.document.body,e)),!1}getTagNames(){return["frame","iframe"]}});p.register(new class extends l{convert(e,t){const r=parseInt(e.tagName.match(/([1-6])$/)[1],10);e.appendParagraph();let n="";for(let e=0;e<r;e++)n+="#";return e.output(`${n} `),!0}getTagNames(){return["h1","h2","h3","h4","h5","h6"]}});p.register(new class extends l{convert(e,t){return e.appendParagraph().output("---").appendParagraph(),!1}getTagNames(){return["hr"]}});p.register(new class extends l{afterAll(e){const{images:t}=e.context;if(t.length){e.append("\n\n");for(let r=0;r<t.length;r++)e.append(`[image${r}]: ${t[r]}\n`)}}beforeAll(e){e.context.imageMap={},e.context.images=[]}convert(e,t){const{element:r,options:n}=e,a=n.absolute?r.src:r.getAttribute("src");if(!a)return!1;const s=r.getAttribute("alt")||"",{imageMap:i,images:o}=e.context,l=r.getAttribute("title");let u,c=l?`${a} "${l}"`:a;return n.inline?c=`(${c})`:(null==(u=i[c])&&(u=o.push(c)-1,i[c]=u),c=`[image${u}]`),e.output(`![${s}]${c}`),!1}getTagNames(){return["img"]}});p.register(new class extends l{convert(e,r){const n=e.inOrderedList?`${e.listIndex++}. `:"* ";return e.atLeft?e.last&&(e.last=e.last.replace(/[ ]{2,4}$/,"\n")):(e.append(e.left.replace(/[ ]{2,4}$/,"\n")),e.atLeft=!0,e.atNoWhiteSpace=!0,e.atParagraph=!0),e.append(t.leftPad(n,2*(e.listDepth-1))),!0}getTagNames(){return["li"]}});p.register(new class extends l{after(e,t){e.inOrderedList=t.previousInOrderedList,e.listIndex=t.previousListIndex,e.listDepth--}before(e,t){t.previousInOrderedList=e.inOrderedList,t.previousListIndex=e.listIndex}convert(e,t){return 0===e.listDepth&&e.appendParagraph(),e.inOrderedList=!0,e.listIndex=1,e.listDepth++,!0}getTagNames(){return["ol"]}});p.register(new class extends l{convert(e,t){return e.appendParagraph(),!0}getTagNames(){return["address","article","aside","div","fieldset","footer","header","nav","p","section"]}});p.register(new class extends l{after(e,t){e.atLeft=!1,e.atParagraph=!1,e.inPreformattedBlock=t.previousInPreformattedBlock,e.left=t.previousLeft,e.appendParagraph()}before(e,t){t.previousInPreformattedBlock=e.inPreformattedBlock,t.previousLeft=e.left}convert(e,t){return e.left+="    ",e.atParagraph?e.append("    "):e.appendParagraph(),!0}getTagNames(){return["pre"]}});p.register(new class extends l{after(e,t){e.output('"')}convert(e,t){return e.output('"'),e.atNoWhiteSpace=!0,!0}getTagNames(){return["q"]}});p.register(new class extends l{after(e,t){e.output("**")}convert(e,t){return e.output("**"),e.atNoWhiteSpace=!0,!0}getTagNames(){return["b","strong"]}});p.register(new class extends l{after(e,t){e.inOrderedList=t.previousInOrderedList,e.listIndex=t.previousListIndex,e.listDepth--}before(e,t){t.previousInOrderedList=e.inOrderedList,t.previousListIndex=e.listIndex}convert(e,t){return 0===e.listDepth&&e.appendParagraph(),e.inOrderedList=!1,e.listIndex=1,e.listDepth++,!0}getTagNames(){return["ul"]}});var d=p;var h=class{getName(){}};var f=class extends h{closeWindow(e){this.isCloseable(e)&&e.close()}getDefaultBaseUri(){}getName(){return"window"}getWindow(e){}isCloseable(e){return!1}},g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),w=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v=function(e){function t(){return g(this,t),w(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f),m(t,[{key:"getDefaultBaseUri",value:function(){return window.document.baseURI}},{key:"getWindow",value:function(e){return window}}]),t}();return d.use(new v),d});
//# sourceMappingURL=europa.min.js.map
