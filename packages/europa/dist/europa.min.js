/*! Europa v4.0.0 | (C) 2018 Alasdair Mercer, !ninja | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Europa=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=function(){function n(){e(this,n)}return t(n,null,[{key:"forOwn",value:function(e,t,r){if(e)for(var i in e)n.hasOwn(e,i)&&t.call(r,e[i],i,e)}},{key:"hasOwn",value:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},{key:"leftPad",value:function(e,t,n){if(null==e&&(e=""),null==t&&(t=0),null==n&&(n=" "),!n)return e;for(var r=0;r<t;r++)e=n+e;return e}}]),n}(),o={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},u={};i.forOwn(o,function(e,t){u[t]=new RegExp(t,"g")});var a=function(){function n(t,r){e(this,n),this.europa=t,this.options=r,this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0,this.buffer="",this.context={},this.inCodeBlock=!1,this.inOrderedList=!1,this.inPreformattedBlock=!1,this.last=null,this.left="\n",this.listDepth=0,this.listIndex=1,this._document=t.document,this._element=null,this._tagName=null,this._window=t.window}return t(n,[{key:"append",value:function(e){return null!=this.last&&(this.buffer+=this.last),this.last=e,this}},{key:"appendParagraph",value:function(){return this.atParagraph?this:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWhiteSpace=!0,this.atParagraph=!0,this)}},{key:"output",value:function(e,t){return e?(e=e.replace(/\r\n/g,"\n"),t&&(e=e.replace(/\n([ \t]*\n)+/g,"\n").replace(/\n[ \t]+/g,"\n").replace(/[ \t]+/g," "),i.forOwn(o,function(t,n){e=e.replace(u[n],t)})),this.inPreformattedBlock||(e=this.atNoWhiteSpace?e.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(e)?e.replace(/^[ \t\n]+/,"\n"):e.replace(/^[ \t]+/," ")),e?(this.atLeft=/\n$/.test(e),this.atNoWhiteSpace=/[ \t\n]$/.test(e),this.atParagraph=/\n{2}$/.test(e),this.append(e.replace(/\n/g,this.left))):this):this}},{key:"replaceLeft",value:function(e){return this.atLeft?this.last&&(this.last=this.last.replace(/[ ]{2,4}$/,e)):(this.append(this.left.replace(/[ ]{2,4}$/,e)),this.atLeft=!0,this.atNoWhiteSpace=!0,this.atParagraph=!0),this}},{key:"document",get:function(){return this._document}},{key:"element",get:function(){return this._element},set:function(e){this._element=e,this._tagName=e&&e.tagName?e.tagName.toLowerCase():null}},{key:"tagName",get:function(){return this._tagName}},{key:"window",get:function(){return this._window},set:function(e){this._window=e,this._document=e?e.document:null}}]),n}(),s=function(){function n(){e(this,n)}return t(n,null,[{key:"isVisible",value:function(e,t){var n=t.getComputedStyle(e);return"none"!==n.getPropertyValue("display")&&"hidden"!==n.getPropertyValue("visibility")}}]),n}(),c=function(){function n(t,r){e(this,n),this.name=t,this._defaultValue=r}return t(n,[{key:"defaultValue",get:function(){var e=this._defaultValue;return"function"==typeof e?e.call(this):e}}]),n}(),l=function(){function n(t){e(this,n),this.options=t}return t(n,[{key:"exists",value:function(e){return this.options.some(function(t){return t.name===e})}},{key:"parse",value:function(e){e||(e={});var t={};return this.options.forEach(function(n){var r=n.name,i=null!=e[r]?e[r]:n.defaultValue;t[r]=i}),t}}]),n}(),f=function(){function n(){e(this,n)}return t(n,[{key:"after",value:function(e,t){}},{key:"afterAll",value:function(e){}},{key:"before",value:function(e,t){}},{key:"beforeAll",value:function(e){}},{key:"convert",value:function(e,t){return!0}},{key:"getTagNames",value:function(){return[]}}]),n}(),p={},h=new(function(){function n(){e(this,n),this._services={}}return t(n,[{key:"getService",value:function(e){var t=this._services[e];if(!t)throw new Error("Service is not being managed with name: "+e);return t}},{key:"setService",value:function(e,t){if(this._services[e])throw new Error("Service is already managed with name: "+e);t&&(this._services[e]=t)}}]),n}()),v=function(){function n(t){e(this,n),this._options=new l([new c("absolute",!1),new c("baseUri",function(){return h.getService("window").getDefaultBaseUri()}),new c("inline",!1)]).parse(t),this._window=null}return t(n,null,[{key:"register",value:function(e){e.getTagNames().forEach(function(t){p[t]=e})}},{key:"use",value:function(e){h.setService(e.getName(),e)}},{key:"Plugin",get:function(){return f}}]),t(n,[{key:"convert",value:function(e){if(!e)return"";var t=this.document,n=void 0;"string"==typeof e?(n=t.createElement("div")).innerHTML=e:n=e;var r=new a(this,this._options),o=void 0;t.contains(n)||((o=t.createElement("div")).style.display="none",o.appendChild(n),t.body.appendChild(o));try{i.forOwn(p,function(e){return e.beforeAll(r)}),this.convertElement(n,r),i.forOwn(p,function(e){return e.afterAll(r)})}finally{o&&(t.body.removeChild(o),o.removeChild(n))}return r.append("").buffer.trim()}},{key:"convertElement",value:function(e,t){if(e){var n=this.window;if(e.nodeType===n.Node.ELEMENT_NODE){if(!s.isVisible(e,n))return;t.element=e;var r={},i=p[t.tagName],o=!0;if(i&&(i.before(t,r),o=i.convert(t,r)),o)for(var u=0;u<e.childNodes.length;u++)this.convertElement(e.childNodes[u],t);i&&i.after(t,r)}else if(e.nodeType===n.Node.TEXT_NODE){var a=e.nodeValue||"";t.inPreformattedBlock?t.output(a):t.inCodeBlock?t.output(a.replace(/`/g,"\\`")):t.output(a,!0)}}}},{key:"release",value:function(){return this._window&&(h.getService("window").closeWindow(this._window),this._window=null),this}},{key:"document",get:function(){return this.window.document}},{key:"window",get:function(){return this._window||(this._window=h.getService("window").getWindow(this._options.baseUri)),this._window}}]),n}(),d=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){null!=t.value&&e.output("]"+t.value)}},{key:"afterAll",value:function(e){var t=e.context.anchors;if(t.length){e.append("\n\n");for(var n=0;n<t.length;n++)e.append("[anchor"+n+"]: "+t[n]+"\n")}}},{key:"beforeAll",value:function(e){e.context.anchorMap={},e.context.anchors=[]}},{key:"convert",value:function(e,t){var n=e.element,r=e.options,i=r.absolute?n.href:n.getAttribute("href");if(!i)return!0;var o=e.context,u=o.anchorMap,a=o.anchors,s=n.getAttribute("title"),c=s?i+' "'+s+'"':i,l=void 0;return r.inline?t.value="("+c+")":(null==(l=u[c])&&(l=a.push(c)-1,u[c]=l),t.value="[anchor"+l+"]"),e.output("["),e.atNoWhiteSpace=!0,!0}},{key:"getTagNames",value:function(){return["a"]}}]),o}();v.register(new d);var y=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.atLeft=!1,e.atParagraph=!1,e.left=t.previousLeft,e.appendParagraph()}},{key:"before",value:function(e,t){t.previousLeft=e.left}},{key:"convert",value:function(e,t){return e.left+="> ",e.atParagraph?e.append("> "):e.appendParagraph(),!0}},{key:"getTagNames",value:function(){return["blockquote","dd"]}}]),o}();v.register(new y);var g=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"convert",value:function(e,t){return e.append("  "+e.left),e.atLeft=!0,e.atNoWhiteSpace=!0,!1}},{key:"getTagNames",value:function(){return["br"]}}]),o}();v.register(new g);var _=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){t.skipped||(e.inCodeBlock=t.previousInCodeBlock,e.output("`"))}},{key:"before",value:function(e,t){t.previousInCodeBlock=e.inCodeBlock}},{key:"convert",value:function(e,t){return e.inPreformattedBlock?t.skipped=!0:(e.output("`"),e.inCodeBlock=!0),!0}},{key:"getTagNames",value:function(){return["code","kbd","samp"]}}]),o}();v.register(new _);var k=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.output("**")}},{key:"convert",value:function(e,t){return e.appendParagraph(),e.output("**"),e.atNoWhiteSpace=!0,!0}},{key:"getTagNames",value:function(){return["dt"]}}]),o}();v.register(new k);var m=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"convert",value:function(e,t){var n=e.element;if(e.appendParagraph(),n.hasAttribute("open"))return!0;var r=n.querySelector("summary");return e.europa.convertElement(r,e),!1}},{key:"getTagNames",value:function(){return["details"]}}]),o}();v.register(new m);var w=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.output("_")}},{key:"convert",value:function(e,t){return e.output("_"),e.atNoWhiteSpace=!0,!0}},{key:"getTagNames",value:function(){return["cite","dfn","em","i","u","var"]}}]),o}();v.register(new w);var b=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"convert",value:function(e,t){return!1}},{key:"getTagNames",value:function(){return["applet","area","audio","button","canvas","datalist","embed","head","input","map","menu","meter","noframes","noscript","object","optgroup","option","param","progress","rp","rt","ruby","script","select","style","textarea","title","video"]}}]),o}();v.register(new b);var O=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.window=t.previousWindow}},{key:"before",value:function(e,t){t.previousWindow=e.window}},{key:"convert",value:function(e,t){var n=e.element.contentWindow;return n&&(e.window=n,e.europa.convertElement(n.document.body,e)),!1}},{key:"getTagNames",value:function(){return["frame","iframe"]}}]),o}();v.register(new O);var P=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"convert",value:function(e,t){var n=parseInt(e.tagName.match(/([1-6])$/)[1],10);e.appendParagraph();for(var r="",i=0;i<n;i++)r+="#";return e.output(r+" "),!0}},{key:"getTagNames",value:function(){return["h1","h2","h3","h4","h5","h6"]}}]),o}();v.register(new P);var N=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"convert",value:function(e,t){return e.appendParagraph().output("---").appendParagraph(),!1}},{key:"getTagNames",value:function(){return["hr"]}}]),o}();v.register(new N);var L=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"afterAll",value:function(e){var t=e.context.images;if(t.length){e.append("\n\n");for(var n=0;n<t.length;n++)e.append("[image"+n+"]: "+t[n]+"\n")}}},{key:"beforeAll",value:function(e){e.context.imageMap={},e.context.images=[]}},{key:"convert",value:function(e,t){var n=e.element,r=e.options,i=r.absolute?n.src:n.getAttribute("src");if(!i)return!1;var o=n.getAttribute("alt")||"",u=e.context,a=u.imageMap,s=u.images,c=n.getAttribute("title"),l=c?i+' "'+c+'"':i,f=void 0;return r.inline?l="("+l+")":(null==(f=a[l])&&(f=s.push(l)-1,a[l]=f),l="[image"+f+"]"),e.output("!["+o+"]"+l),!1}},{key:"getTagNames",value:function(){return["img"]}}]),o}();v.register(new L);var j=function(o){function u(){return e(this,u),r(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return n(u,f),t(u,[{key:"convert",value:function(e,t){var n=e.inOrderedList?e.listIndex+++". ":"* ";return e.atLeft?e.last&&(e.last=e.last.replace(/[ ]{2,4}$/,"\n")):(e.append(e.left.replace(/[ ]{2,4}$/,"\n")),e.atLeft=!0,e.atNoWhiteSpace=!0,e.atParagraph=!0),e.append(i.leftPad(n,2*(e.listDepth-1))),!0}},{key:"getTagNames",value:function(){return["li"]}}]),u}();v.register(new j);var T=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.inOrderedList=t.previousInOrderedList,e.listIndex=t.previousListIndex,e.listDepth--}},{key:"before",value:function(e,t){t.previousInOrderedList=e.inOrderedList,t.previousListIndex=e.listIndex}},{key:"convert",value:function(e,t){return 0===e.listDepth&&e.appendParagraph(),e.inOrderedList=!0,e.listIndex=1,e.listDepth++,!0}},{key:"getTagNames",value:function(){return["ol"]}}]),o}();v.register(new T);var x=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"convert",value:function(e,t){return e.appendParagraph(),!0}},{key:"getTagNames",value:function(){return["address","article","aside","div","fieldset","footer","header","nav","p","section"]}}]),o}();v.register(new x);var S=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.atLeft=!1,e.atParagraph=!1,e.inPreformattedBlock=t.previousInPreformattedBlock,e.left=t.previousLeft,e.appendParagraph()}},{key:"before",value:function(e,t){t.previousInPreformattedBlock=e.inPreformattedBlock,t.previousLeft=e.left}},{key:"convert",value:function(e,t){return e.left+="    ",e.atParagraph?e.append("    "):e.appendParagraph(),!0}},{key:"getTagNames",value:function(){return["pre"]}}]),o}();v.register(new S);var E=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.output('"')}},{key:"convert",value:function(e,t){return e.output('"'),e.atNoWhiteSpace=!0,!0}},{key:"getTagNames",value:function(){return["q"]}}]),o}();v.register(new E);var I=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.output("**")}},{key:"convert",value:function(e,t){return e.output("**"),e.atNoWhiteSpace=!0,!0}},{key:"getTagNames",value:function(){return["b","strong"]}}]),o}();v.register(new I);var W=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,f),t(o,[{key:"after",value:function(e,t){e.inOrderedList=t.previousInOrderedList,e.listIndex=t.previousListIndex,e.listDepth--}},{key:"before",value:function(e,t){t.previousInOrderedList=e.inOrderedList,t.previousListIndex=e.listIndex}},{key:"convert",value:function(e,t){return 0===e.listDepth&&e.appendParagraph(),e.inOrderedList=!1,e.listIndex=1,e.listDepth++,!0}},{key:"getTagNames",value:function(){return["ul"]}}]),o}();v.register(new W);var B=v,C=function(){function n(){e(this,n)}return t(n,[{key:"getName",value:function(){}}]),n}(),A=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,C),t(o,[{key:"closeWindow",value:function(e){this.isCloseable(e)&&e.close()}},{key:"getDefaultBaseUri",value:function(){}},{key:"getName",value:function(){return"window"}},{key:"getWindow",value:function(e){}},{key:"isCloseable",value:function(e){return!1}}]),o}(),D=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,A),t(o,[{key:"getDefaultBaseUri",value:function(){return window.document.baseURI}},{key:"getWindow",value:function(e){return window}}]),o}();return B.use(new D),B});
//# sourceMappingURL=europa.min.js.map
